<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>BookNest - View Reservations</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background: #f8f9fa; }
    .card { max-width: 1000px; margin: 2rem auto; }
    .table-wrap { overflow-x:auto; }
  </style>
</head>
<body>
  <div class="container">
    <div class="card shadow-sm">
      <div class="card-body">
        <h3 class="card-title mb-3">Saved Reservations</h3>

        <div id="contentArea"></div>

        <div class="mt-3">
          <a href="index.html" class="btn btn-primary">New Reservation</a>
          <button id="clearAll" class="btn btn-outline-danger">Clear All Reservations</button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    const key = 'bookings';

    function renderTable(bookings) {
      if (!bookings || bookings.length === 0) {
        document.getElementById('contentArea').innerHTML = '<div class="alert alert-info">No bookings available.</div>';
        return;
      }

      let html = `
        <div class="table-wrap">
          <table class="table table-striped table-hover">
            <thead>
              <tr>
                <th>#</th>
                <th>Name</th>
                <th>Phone</th>
                <th>Email</th>
                <th>Book Title</th>
                <th>Author</th>
                <th>Pickup Date</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>`;

      bookings.forEach((b, idx) => {
        html += `
          <tr data-id="${b.id}">
            <td>${idx + 1}</td>
            <td>${escapeHtml(b.fullName)}</td>
            <td>${escapeHtml(b.phone)}</td>
            <td>${escapeHtml(b.email)}</td>
            <td>${escapeHtml(b.bookTitle)}</td>
            <td>${escapeHtml(b.authorName)}</td>
            <td>${escapeHtml(b.pickupDate)}</td>
            <td>
              <button class="btn btn-sm btn-danger delete-btn">Delete</button>
            </td>
          </tr>
        `;
      });

      html += `</tbody></table></div>`;
      document.getElementById('contentArea').innerHTML = html;

      // attach delete handlers
      document.querySelectorAll('.delete-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          const row = this.closest('tr');
          const id = Number(row.getAttribute('data-id'));
          if (!confirm('Delete this reservation?')) return;
          const current = JSON.parse(localStorage.getItem(key) || '[]');
          const filtered = current.filter(x => x.id !== id);
          localStorage.setItem(key, JSON.stringify(filtered));
          renderTable(filtered);
        });
      });
    }
    function escapeHtml(str = '') {
      return String(str).replace(/[&<>"'`=\/]/g, function (s) {
        return ({
          '&': '&amp;',
          '<': '&lt;',
          '>': '&gt;',
          '"': '&quot;',
          "'": '&#39;',
          '/': '&#x2F;',
          '`': '&#x60;',
          '=': '&#x3D;'
        })[s];
      });
    }
    document.addEventListener('DOMContentLoaded', () => {
      const bookings = JSON.parse(localStorage.getItem(key) || '[]');
      renderTable(bookings);

      document.getElementById('clearAll').addEventListener('click', () => {
        if (!confirm('Clear all reservations? This cannot be undone.')) return;
        localStorage.removeItem(key);
        renderTable([]);
      });
    });
  </script>
</body>
</html>
